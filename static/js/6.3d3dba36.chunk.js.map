{"version":3,"sources":["panes/profile/preferences/trustedApplications/view.tsx","panes/profile/preferences/trustedApplications/container.tsx"],"names":["View","props","react","className","apps","map","app","view_ApplicationRow","key","origin","onSave","onSaveApp","onDelete","onDeleteApp","view_NewApplication","ApplicationRow","initialModes","Read","modes","indexOf","Append","Write","Control","_React$useState","React","_React$useState2","Object","slicedToArray","setModes","getCheckboxHandler","mode","event","checked","objectSpread","defineProperty","setMode","target","onSubmit","preventDefault","newModes","keys","filter","type","onChange","name","id","onClick","NewApplication","_React$useState3","_React$useState4","setOrigin","_React$useState5","_React$useState6","e","value","placeholder","TrustedApplications","fetchedTrustedApps","fetchTrustedApps","store","profile","useState","trustedApps","setTrustedApps","updater","editable","doc","uri","react_default","a","createElement","view_View","Promise","resolve","deletions","getStatementsToDelete","$rdf","sym","additions","getStatementsToAdd","Math","random","toString","substring","update","newApp","subject","into","index","findIndex","found","concat","slice","insertTrustedApp","from","removeTrustedApp"],"mappings":"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","file":"static/js/6.3d3dba36.chunk.js","sourcesContent":["import * as React from 'react'\nimport { NamedNode } from 'rdflib'\nimport { TrustedApplication, Mode } from './model'\n\ntype AddOrUpdate = (origin: string, modes: Mode[]) => Promise<void>\ninterface Props {\n  apps: Array<Exclude<TrustedApplication, { subject: NamedNode}>>;\n  onSaveApp: AddOrUpdate;\n  onDeleteApp: (origin: string) => Promise<void>;\n}\n\nexport const View: React.FC<Props> = (props) => {\n  return (\n    <>\n      <h2 className=\"title\">Applications</h2>\n      <p className=\"content\">Manage which applications can access data on your Pod.</p>\n      <p className=\"content\">Note: applications will never have more access than you have.</p>\n      <table className=\"table is-fullwidth is-bordered is-striped\">\n        <thead>\n          <tr>\n            <th>Application URL</th>\n            <th>Access level</th>\n            <th></th>\n          </tr>\n        </thead>\n        <tbody>\n          {props.apps.map((app) => (\n            <ApplicationRow\n              key={app.origin}\n              app={app}\n              onSave={props.onSaveApp}\n              onDelete={props.onDeleteApp}\n            />\n          ))}\n        </tbody>\n      </table>\n      <NewApplication onSave={props.onSaveApp}/>\n    </>\n  )\n}\n\nconst ApplicationRow: React.FC<{\n  app: TrustedApplication,\n  onSave: AddOrUpdate,\n  onDelete: (origin: string) => Promise<void>\n}> = (props) => {\n  const initialModes = {\n    Read: props.app.modes.indexOf('Read') !== -1,\n    Append: props.app.modes.indexOf('Append') !== -1,\n    Write: props.app.modes.indexOf('Write') !== -1,\n    Control: props.app.modes.indexOf('Control') !== -1\n  }\n  const [modes, setModes] = React.useState<{[ key: string]: boolean}>(initialModes)\n\n  const setMode = (mode: Mode, checked: boolean) => {\n    setModes({ ...modes, [mode]: checked })\n  }\n  const getCheckboxHandler = (mode: Mode) => {\n    return (event: React.ChangeEvent<HTMLInputElement>) => setMode(mode, event.target.checked)\n  }\n\n  const submitHandler = (event: React.FormEvent) => {\n    event.preventDefault()\n\n    const newModes = Object.keys(modes).filter(mode => modes[mode]) as Mode[]\n    props.onSave(props.app.origin, newModes)\n  }\n\n  return (\n    <tr>\n      <td>\n        <p>{props.app.origin}</p>\n      </td>\n      <td>\n        <form onSubmit={submitHandler}>\n          <div className=\"field is-grouped\">\n            <div className=\"control\">\n              <label className=\"checkbox\">\n                <input\n                  type=\"checkbox\"\n                  onChange={getCheckboxHandler('Read')}\n                  checked={modes.Read}\n                  name=\"Read\"\n                  id=\"Read\"\n                />\n                Read\n              </label>\n            </div>\n            <div className=\"control\">\n              <label className=\"checkbox\">\n                <input\n                  type=\"checkbox\"\n                  onChange={getCheckboxHandler('Append')}\n                  checked={modes.Append}\n                  name=\"Append\"\n                  id=\"Append\"\n                />\n                Append\n              </label>\n            </div>\n            <div className=\"control\">\n              <label className=\"checkbox\">\n                <input\n                  type=\"checkbox\"\n                  onChange={getCheckboxHandler('Write')}\n                  checked={modes.Write}\n                  name=\"Write\"\n                  id=\"Write\"\n                />\n                Write\n              </label>\n            </div>\n            <div className=\"control\">\n              <label className=\"checkbox\">\n                <input\n                  type=\"checkbox\"\n                  onChange={getCheckboxHandler('Control')}\n                  checked={modes.Control}\n                  name=\"Control\"\n                  id=\"Control\"\n                />\n                Control\n              </label>\n            </div>\n          </div>\n          <div className=\"field\">\n            <div className=\"control\">\n              <button type=\"submit\" className=\"button is-small\">Save</button>\n            </div>\n          </div>\n        </form>\n      </td>\n      <td className=\"has-text-right is-narrow\">\n        <button\n          onClick={() => props.onDelete(props.app.origin)}\n          className=\"button is-danger is-small\"\n        >Delete</button>\n      </td>\n    </tr>\n  )\n}\n\nconst NewApplication: React.FC<{ onSave: AddOrUpdate }> = (props) => {\n  const [origin, setOrigin] = React.useState()\n  const [modes, setModes] = React.useState<{[ key: string]: boolean}>({\n    Read: false,\n    Append: false,\n    Write: false,\n    Control: false\n  })\n\n  const setMode = (mode: Mode, checked: boolean) => {\n    setModes({ ...modes, [mode]: checked })\n  }\n  const getCheckboxHandler = (mode: Mode) => {\n    return (event: React.ChangeEvent<HTMLInputElement>) => setMode(mode, event.target.checked)\n  }\n\n  const submitHandler = (event: React.FormEvent) => {\n    event.preventDefault()\n\n    const newModes = Object.keys(modes).filter(mode => modes[mode]) as Mode[]\n    props.onSave(origin, newModes)\n  }\n\n  return (\n    <form onSubmit={submitHandler} className=\"footer\">\n      <div className=\"field\">\n        <label className=\"label\">App URL:</label>\n        <input\n          type=\"url\"\n          onChange={(e) => setOrigin(e.target.value)}\n          name=\"origin\"\n          id=\"origin\"\n          placeholder=\"https://example.com\"\n          className=\"input\"\n        />\n      </div>\n      <div className=\"field\">\n        <div className=\"control\">\n          <label className=\"checkbox\">\n            <input\n              type=\"checkbox\"\n              onChange={getCheckboxHandler('Read')}\n              name=\"Read\"\n              id=\"Read\"\n            />\n            Read\n          </label>\n          <label className=\"checkbox\">\n            <input\n              type=\"checkbox\"\n              onChange={getCheckboxHandler('Append')}\n              name=\"Append\"\n              id=\"Append\"\n            />\n            Append\n          </label>\n          <label className=\"checkbox\">\n            <input\n              type=\"checkbox\"\n              onChange={getCheckboxHandler('Write')}\n              name=\"Write\"\n              id=\"Write\"\n            />\n            Write\n          </label>\n          <label className=\"checkbox\">\n            <input\n              type=\"checkbox\"\n              onChange={getCheckboxHandler('Control')}\n              name=\"Control\"\n              id=\"Control\"\n            />\n            Control\n          </label>\n        </div>\n      </div>\n      <div className=\"field\">\n        <div className=\"control\">\n          <button type=\"submit\" className=\"button is-primary\">Give access</button>\n        </div>\n      </div>\n    </form>\n  )\n}","import React from 'react';\nimport $rdf, { NamedNode, IndexedFormula, UpdateManager } from 'rdflib';\nimport { TrustedApplication, Mode } from './model';\nimport { fetchTrustedApps, getStatementsToAdd, getStatementsToDelete } from './service';\nimport { View } from './view';\n\ninterface Props {\n  profile: NamedNode;\n  store: IndexedFormula;\n  updater: UpdateManager;\n};\n\nexport const TrustedApplications: React.FC<Props> = (props) => {\n  const fetchedTrustedApps: TrustedApplication[] = fetchTrustedApps(props.store, props.profile);\n\n  const [trustedApps, setTrustedApps] = React.useState(fetchedTrustedApps);\n\n  const isEditable: boolean = (props.updater as any).editable(props.profile.doc().uri, props.store);\n  if (!isEditable) {\n    return <div>Your profile {props.profile.doc().uri} is not editable, so we cannot do much here.</div>;\n  }\n\n  const addOrEditApp = (origin: string, modes: Mode[]) => {\n    const result = new Promise<void>((resolve) => {\n      const deletions = getStatementsToDelete($rdf.sym(origin), props.profile, props.store);\n      const additions = getStatementsToAdd($rdf.sym(origin), generateRandomString(), modes, props.profile);\n      props.store.updater!.update(deletions, additions, () => {\n        const newApp: TrustedApplication = { subject: props.profile.value, origin, modes };\n        setTrustedApps(insertTrustedApp(newApp, trustedApps));\n        resolve();\n      })\n    })\n\n    return result;\n  }\n\n  const deleteApp = (origin: string) => {\n    const result = new Promise<void>((resolve) => {\n      const deletions = getStatementsToDelete($rdf.sym(origin), props.profile, props.store);\n      props.store.updater!.update(deletions, [], () => {\n        setTrustedApps(removeTrustedApp(origin, trustedApps));\n        resolve();\n      })\n    })\n\n    return result;\n  }\n\n  return (\n    <section>\n      <View\n        apps={trustedApps}\n        onSaveApp={addOrEditApp}\n        onDeleteApp={deleteApp}\n      />\n    </section>\n  )\n}\n\nfunction insertTrustedApp (app: TrustedApplication, into: TrustedApplication[]): TrustedApplication[] {\n  const index = into.findIndex(found => found.origin === app.origin)\n  if (index === -1) {\n    return into.concat(app)\n  }\n\n  return into.slice(0, index)\n    .concat(app)\n    .concat(into.slice(index + 1))\n}\nfunction removeTrustedApp (origin: string, from: TrustedApplication[]): TrustedApplication[] {\n  const index = from.findIndex(found => found.origin === origin)\n  return (index === -1)\n    ? from\n    : from.slice(0, index).concat(from.slice(index + 1))\n}\n\nfunction generateRandomString (): string {\n  return Math.random().toString(36).substring(7)\n}\n"],"sourceRoot":""}